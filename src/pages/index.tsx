import { useState } from 'react';
import { type NextPage } from 'next';
import Head from 'next/head';
import { api } from 'utils/api';
import { Navbar } from 'components/Navbar';
import { CategoryEntry } from 'components/CategoryEntry';
import { Header } from 'components/Header';

// TODO: Use SSR
const Home: NextPage = () => {
  const [isMenuOpen, setIsMenuOpen] = useState(false);
  const [activeCategory, setActiveCategory] = useState<string>();
  const { isSuccess, data } = api.entities.getCategories.useQuery(undefined, {
    staleTime: Infinity,
  });

  return (
    <>
      <Head>
        <title>Create T3 App</title>
        <meta name='description' content='Generated by create-t3-app' />
        <link rel='icon' href='/favicon.ico' />
      </Head>
      {isSuccess ? (
        <>
          <Header isMenuOpen={isMenuOpen} setIsMenuOpen={setIsMenuOpen} />
          <Navbar
            activeLink={activeCategory}
            links={data
              .filter(({ listed }) => listed)
              .map(({ categoryName }) => categoryName)}
          />
          <main className='px-4'>
            {data.map((category) =>
              category.listed ? (
                <CategoryEntry
                  key={category.id}
                  id={category.id}
                  title={category.categoryName}
                  setActiveCategory={setActiveCategory}
                />
              ) : null
            )}
          </main>
        </>
      ) : (
        'loading'
      )}
    </>
  );
};

export default Home;
